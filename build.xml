<?xml version="1.0" encoding="UTF-8"?>
<project name="iprotium-util" basedir="." default="jar"
         xmlns:artifact="antlib:org.apache.maven.artifact.ant">

  <description>
    iprotium-util.jar
    -----------------
    Java Utilities

    $Id$
  </description>

  <property name="build.properties.file" location="build.properties"/>
  <property file="${build.properties.file}"/>
  <property name="build.sysclasspath"   value="ignore"/>
  <property name="build.compiler.adapter"
            value="iprotium.util.ant.taskdefs.compilers.LintAdapter"/>
  <available classname="${build.compiler.adapter}"
             property="build.compiler" value="${build.compiler.adapter}"/>

  <property name="src.dir"              location="src"/>

  <property name="target.dir"           location="target"/>
  <property name="target.classes.dir"   location="${target.dir}/classes"/>
  <property name="target.headers.dir"   location="${target.dir}/headers"/>
  <property name="target.objects.dir"   location="${target.dir}/objects"/>

  <property name="vendor"               value="iprotium.com"/>

  <path id="build.classpath">
    <pathelement location="${target.classes.dir}"/>
    <fileset dir="${target.dir}" includes="**/*.jar"/>
    <path refid="compile.classpath"/>
  </path>

  <target name="clean"
          description="--> Removes compilation files and directories."
          depends="">
    <delete dir="${target.dir}"/>
  </target>

  <target name="depend"
          description="--> Set-up dependencies.">
    <artifact:pom id="pom" file="pom.xml"/>
    <artifact:dependencies
        pomRefId="pom" useScope="compile" type="jar"
        pathId="compile.classpath"/>
    <artifact:dependencies
        pomRefId="pom" useScope="runtime" type="jar"
        pathId="runtime.classpath"/>
    <artifact:dependencies
        pomRefId="pom" useScope="runtime"
        filesetId="runtime.fileset" versionsId="runtime.versions"/>
    <property name="artifact"
              value="${pom.artifactId}-${pom.version}.jar"/>
  </target>

  <target name="buildnumber" unless="buildnumber">
    <tstamp>
      <format property="buildnumber.date" pattern="yyyyMMdd"/>
      <format property="buildnumber.time" pattern="HHmm"/>
    </tstamp>
    <property name="buildnumber"
              value="${buildnumber.date}${buildnumber.time}"/>
    <echo>${buildnumber}</echo>
  </target>

  <target name="classes"
          description="--> Compile Java source."
          depends="depend">
    <mkdir dir="${target.classes.dir}"/>
    <filter token="POM.ARTIFACTID" value="${pom.artifactId}"/>
    <filter token="VENDOR" value="${vendor}"/>
    <copy filtering="true" preservelastmodified="true"
          todir="${target.classes.dir}">
      <fileset dir="${src.dir}/main/resources"/>
    </copy>
    <javac destdir="${target.classes.dir}">
      <compilerarg compiler="modern" value="-Xlint"/>
      <compilerarg compiler="modern" value="-g:source,lines,vars"/>
      <classpath>
        <path refid="build.classpath"/>
      </classpath>
      <src path="${src.dir}/main/java"/>
    </javac>
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <jni-classes classpathref="build.classpath"
                 basedir="${target.classes.dir}" property="jni.classes">
      <src path="${src.dir}/main/java"/>
    </jni-classes>
    <provider-file-for classpathref="build.classpath"
                       basedir="${target.classes.dir}"
                       service="iprotium.tools.Remedy"/>
    <provider-file-for classpathref="build.classpath"
                       basedir="${target.classes.dir}"
                       service="javax.annotation.processing.Processor"/>
  </target>

  <target name="jar"
          description="--> Construct iprotium-util.jar."
          depends="buildnumber,classes">
    <jar destfile="${target.dir}/${artifact}">
      <fileset dir="${target.classes.dir}"/>
      <manifest>
        <attribute name="Built-By" value="${user.name}"/>
        <section name="iprotium/activation/">
          <attribute name="Extension-Name" value="iprotium.activation"/>
          <attribute name="Specification-Title" value="${pom.artifactId}"/>
          <attribute name="Specification-Version" value="${pom.version}"/>
          <attribute name="Specification-Vendor" value="${vendor}"/>
          <attribute name="Implementation-Title" value="iprotium.activation"/>
          <attribute name="Implementation-Version"
                     value="${pom.version}.${buildnumber.date}"/>
          <attribute name="Implementation-Vendor" value="${vendor}"/>
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/annotation/processing/">
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/beans/">
          <attribute name="Extension-Name" value="iprotium.beans"/>
          <attribute name="Specification-Title" value="${pom.artifactId}"/>
          <attribute name="Specification-Version" value="${pom.version}"/>
          <attribute name="Specification-Vendor" value="${vendor}"/>
          <attribute name="Implementation-Title" value="iprotium.beans"/>
          <attribute name="Implementation-Version"
                     value="${pom.version}.${buildnumber.date}"/>
          <attribute name="Implementation-Vendor" value="${vendor}"/>
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/io/">
          <attribute name="Extension-Name" value="iprotium.io"/>
          <attribute name="Specification-Title" value="${pom.artifactId}"/>
          <attribute name="Specification-Version" value="${pom.version}"/>
          <attribute name="Specification-Vendor" value="${vendor}"/>
          <attribute name="Implementation-Title" value="iprotium.io"/>
          <attribute name="Implementation-Version"
                     value="${pom.version}.${buildnumber.date}"/>
          <attribute name="Implementation-Vendor" value="${vendor}"/>
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/lang/">
          <attribute name="Extension-Name" value="iprotium.lang"/>
          <attribute name="Specification-Title" value="${pom.artifactId}"/>
          <attribute name="Specification-Version" value="${pom.version}"/>
          <attribute name="Specification-Vendor" value="${vendor}"/>
          <attribute name="Implementation-Title" value="iprotium.lang"/>
          <attribute name="Implementation-Version"
                     value="${pom.version}.${buildnumber.date}"/>
          <attribute name="Implementation-Vendor" value="${vendor}"/>
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/lang/java/">
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/lang/lisp/">
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/lang/lisp/scheme/">
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/naming/">
          <attribute name="Extension-Name" value="iprotium.naming"/>
          <attribute name="Specification-Title" value="${pom.artifactId}"/>
          <attribute name="Specification-Version" value="${pom.version}"/>
          <attribute name="Specification-Vendor" value="${vendor}"/>
          <attribute name="Implementation-Title" value="iprotium.naming"/>
          <attribute name="Implementation-Version"
                     value="${pom.version}.${buildnumber.date}"/>
          <attribute name="Implementation-Vendor" value="${vendor}"/>
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/naming/env/">
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/swing/">
          <attribute name="Extension-Name" value="iprotium.swing"/>
          <attribute name="Specification-Title" value="${pom.artifactId}"/>
          <attribute name="Specification-Version" value="${pom.version}"/>
          <attribute name="Specification-Vendor" value="${vendor}"/>
          <attribute name="Implementation-Title" value="iprotium.swing"/>
          <attribute name="Implementation-Version"
                     value="${pom.version}.${buildnumber.date}"/>
          <attribute name="Implementation-Vendor" value="${vendor}"/>
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/text/">
          <attribute name="Extension-Name" value="iprotium.text"/>
          <attribute name="Specification-Title" value="${pom.artifactId}"/>
          <attribute name="Specification-Version" value="${pom.version}"/>
          <attribute name="Specification-Vendor" value="${vendor}"/>
          <attribute name="Implementation-Title" value="iprotium.text"/>
          <attribute name="Implementation-Version"
                     value="${pom.version}.${buildnumber.date}"/>
          <attribute name="Implementation-Vendor" value="${vendor}"/>
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/tools/">
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/tools/javadoc/">
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/util/">
          <attribute name="Extension-Name" value="iprotium.util"/>
          <attribute name="Specification-Title" value="${pom.artifactId}"/>
          <attribute name="Specification-Version" value="${pom.version}"/>
          <attribute name="Specification-Vendor" value="${vendor}"/>
          <attribute name="Implementation-Title" value="iprotium.util"/>
          <attribute name="Implementation-Version"
                     value="${pom.version}.${buildnumber.date}"/>
          <attribute name="Implementation-Vendor" value="${vendor}"/>
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/util/ant/taskdefs/">
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/util/ant/taskdefs/compilers/">
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/util/ant/types/">
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/util/jni/">
          <attribute name="Sealed" value="true"/>
        </section>
      </manifest>
    </jar>
    <jarlib-display file="${target.dir}/${artifact}"/>
  </target>

  <target name="headers"
          description="--> Compile JNI headers."
          depends="classes" if="jni.classes">
    <mkdir dir="${target.headers.dir}"/>
    <javah classpathref="build.classpath" class="${jni.classes}"
           destdir="${target.headers.dir}"/>
  </target>

  <target name="objects"
          description="--> Compile JNI objects."
          depends="headers" if="jni.classes">
    <mkdir dir="${target.objects.dir}"/>
    <available property="use.editline" file="/usr/include/histedit.h"/>
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <jni-cc include="${target.headers.dir}" dest="${target.objects.dir}">
      <define name="USE_EDITLINE" if="use.editline"/>
      <fileset dir="${src.dir}/main/c" includes="*.c"/>
      <mapper type="glob" from="*.c" to="*.o"/>
    </jni-cc>
  </target>

  <target name="jnilib"
          description="--> Compile JNI library."
          depends="objects">
    <available property="link.libuuid" file="/lib/libuuid.so.1"/>
    <system-load-library property="have.libuuid" libname="uuid"/>
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <jni-ld destdir="${target.dir}" libname="${pom.artifactId}"
            property="jnilib">
      <link name="edit" if="use.editline"/>
      <link name="readline" unless="use.editline"/>
      <link name="termcap" unless="use.editline"/>
      <link name="uuid" if="have.libuuid"/>
      <fileset dir="${target.objects.dir}" includes="**/*.o"/>
    </jni-ld>
  </target>

  <target name="install"
          description="--> Installs pom.xml and artifacts to local repository."
          depends="jar,jnilib">
    <jnilib-suffix property="jnilib.suffix"/>
    <artifact:install file="${target.dir}/${artifact}">
      <pom refid="pom"/>
      <attach file="${target.dir}/${jnilib}"
              classifier="${os.name}-${os.arch}" type="${jnilib.suffix}"/>
    </artifact:install>
  </target>

  <target name="bean-info-for"
          description="--> Invokes &lt;bean-info-for/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <bean-info-for classpathref="build.classpath" type="${type}"/>
  </target>

  <target name="charset-list"
          description="--> Invokes &lt;charset-list/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <charset-list/>
  </target>

  <target name="combinations-count"
          description="--> Invokes &lt;combinations-count/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <combinations-count classpathref="build.classpath"
                        type="${type}" count="${count}">
      <argument type="${argument.type}" value="${argument.value}"/>
    </combinations-count>
  </target>

  <target name="combinations-of"
          description="--> Invokes &lt;combinations-of/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <combinations-of classpathref="build.classpath"
                     type="${type}" count="${count}">
      <argument type="${argument.type}" value="${argument.value}"/>
    </combinations-of>
  </target>

  <target name="inet-addresses-for"
          description="--> Invokes &lt;inet-addresses-for/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <inet-addresses-for string="${string}"/>
  </target>

  <target name="instance-of"
          description="--> Invokes &lt;instance-of/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <instance-of classpathref="build.classpath" type="${type}">
      <argument value="${argument}"/>
    </instance-of>
  </target>

  <target name="is-assignable-from"
          description="--> Invokes &lt;is-assignable-from/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <is-assignable-from classpathref="build.classpath"
                        type="${type}" subtype="${subtype}"/>
  </target>

  <target name="jndi-list"
          description="--> Invokes &lt;jndi-list/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <jndi-list classpathref="build.classpath"/>
  </target>

  <target name="jndi-lookup"
          description="--> Invokes &lt;jndi-lookup/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <jndi-lookup classpathref="build.classpath" name="${name}"/>
  </target>

  <target name="jni-classes"
          description="--> Invokes &lt;jni-classes/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <jni-classes classpathref="build.classpath" basedir="${build.class.dir}">
      <src path="${src.dir}/main/java"/>
    </jni-classes>
  </target>

  <target name="jnilib-prefix"
          description="--> Invokes &lt;jnilib-prefix/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <jnilib-prefix/>
  </target>

  <target name="jnilib-suffix"
          description="--> Invokes &lt;jnilib-suffix/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <jnilib-suffix/>
  </target>

  <target name="link"
          description="--> Invokes &lt;link/&gt; task."
          depends="classes">
    <mkdir dir="${target.dir}/links"/>
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <link symbolic="true" relative="true" todir="${target.dir}/links">
      <fileset dir="${target.classes.dir}"/>
    </link>
  </target>

  <target name="locale-list"
          description="--> Invokes &lt;locale-list/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <locale-list/>
  </target>

  <target name="members-of"
          description="--> Invokes &lt;members-of/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <members-of classpathref="build.classpath" type="${type}"/>
  </target>

  <target name="network-interfaces"
          description="--> Invokes &lt;network-interfaces/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <network-interfaces/>
  </target>

  <target name="opendir"
          description="--> Invokes &lt;opendir/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <opendir file="."/>
  </target>

  <target name="package-list"
          description="--> Invokes &lt;package-list/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <package-list classpathref="build.classpath"
                  basedir="${target.classes.dir}">
      <src path="${src.dir}/main/java"/>
    </package-list>
  </target>

  <target name="permutations-count"
          description="--> Invokes &lt;permutations-count/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <permutations-count classpathref="build.classpath" type="${type}">
      <argument type="${argument.type}" value="${argument.value}"/>
    </permutations-count>
  </target>

  <target name="permutations-of"
          description="--> Invokes &lt;permutations-of/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <permutations-of classpathref="build.classpath" type="${type}">
      <argument type="${argument.type}" value="${argument.value}"/>
    </permutations-of>
  </target>

  <target name="readlink"
          description="--> Invokes &lt;readlink/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <readlink basedir="${target.dir}"/>
  </target>

  <target name="resource-list"
          description="--> Invokes &lt;resource-list/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <resource-list classpathref="build.classpath" name="${name}"/>
  </target>

  <target name="run"
          description="--> Invokes &lt;run/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <run classpathref="build.classpath" type="${type}"/>
  </target>

  <target name="service-list"
          description="--> Invokes &lt;service-list/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <service-list classpathref="build.classpath" type="${type}"/>
  </target>

  <target name="show-properties"
          description="--> Invokes &lt;show-properties/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <show-properties classpathref="build.classpath"
                     basedir="${target.classes.dir}">
      <src path="${src.dir}/main/java"/>
    </show-properties>
  </target>

  <target name="subclasses-of"
          description="--> Invokes &lt;subclasses-of/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <subclasses-of classpathref="build.classpath"
                   basedir="${target.classes.dir}" type="${type}">
      <src path="${src.dir}/main/java"/>
    </subclasses-of>
  </target>

  <target name="superclasses-of"
          description="--> Invokes &lt;superclasses-of/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <superclasses-of classpathref="build.classpath" type="${type}"/>
  </target>

  <target name="system-load-library"
          description="--> Invokes &lt;system-load-library/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <system-load-library libname="${name}"/>
  </target>

  <target name="uuid-generate"
          description="--> Invokes &lt;uuid-generate/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <uuid-generate/>
  </target>

  <target name="uuid-generate-random"
          description="--> Invokes &lt;uuid-generate-random/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <uuid-generate-random/>
  </target>

  <target name="uuid-generate-time"
          description="--> Invokes &lt;uuid-generate-time/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <uuid-generate-time/>
  </target>

</project>
