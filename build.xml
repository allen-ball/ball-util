<?xml version="1.0" encoding="UTF-8"?>
<project name="iprotium-util" basedir="." default="jar"
         xmlns:artifact="antlib:org.apache.maven.artifact.ant">

  <description>
    iprotium-util.jar
    -----------------
    Java Utilities

    $Id: build.xml,v 1.12 2009-01-29 05:40:42 ball Exp $
  </description>

  <property name="build.properties.file" location="build.properties"/>
  <property file="${build.properties.file}"/>
  <property name="build.compiler"       value="modern"/>
  <property name="compile.debug"        value="true"/>
  <property name="compile.deprecation"  value="true"/>
  <property name="compile.optimize"     value="true"/>

  <property name="src.dir"              location="src"/>

  <property name="build.dir"            location="build"/>
  <property name="build.class.dir"      location="${build.dir}/class"/>
  <property name="build.header.dir"     location="${build.dir}/header"/>
  <property name="build.object.dir"     location="${build.dir}/object"/>

  <property name="j2se.docs.url"
            value="http://java.sun.com/j2se/${ant.java.version}/docs"/>
  <property name="j2se.api.javadoc.url" value="${j2se.docs.url}/api"/>
  <property name="ant.javadoc.url"
            value="http://nagoya.apache.org/gump/javadoc/ant/build/javadocs"/>

  <property name="vendor"               value="iprotium.com"/>

  <path id="build.classpath">
    <pathelement location="${build.class.dir}"/>
    <fileset dir="${build.dir}" includes="**/*.jar"/>
    <path refid="dependency.classpath"/>
  </path>

  <target name="clean"
          description="--> Removes compilation files and directories."
          depends="">
    <delete dir="${build.dir}"/>
  </target>

  <target name="depend"
          description="--> Set-up dependencies.">
    <artifact:pom id="pom" file="pom.xml"/>
    <artifact:dependencies
       pomRefId="pom" useScope="compile" verbose="true"
       pathId="dependency.classpath"/>
    <artifact:dependencies
       pomRefId="pom" useScope="runtime" verbose="false"
       filesetId="dependency.fileset" versionsId="dependency.versions"/>
    <property name="artifact"
              value="${pom.artifactId}-${pom.version}.jar"/>
  </target>

  <target name="buildnumber" unless="buildnumber">
    <tstamp>
      <format property="buildnumber.date" pattern="yyyyMMdd"/>
      <format property="buildnumber.time" pattern="HHmm"/>
    </tstamp>
    <property name="buildnumber"
              value="${buildnumber.date}${buildnumber.time}"/>
    <echo>${buildnumber}</echo>
  </target>

  <target name="classes"
          description="--> Compile Java source."
          depends="depend">
    <mkdir dir="${build.class.dir}"/>
    <filter token="POM.ARTIFACTID" value="${pom.artifactId}"/>
    <copy filtering="true" preservelastmodified="true"
          todir="${build.class.dir}">
      <fileset dir="${src.dir}/main/resources"/>
    </copy>
    <javac classpathref="build.classpath"
           debug="${compile.debug}" deprecation="${compile.deprecation}"
           optimize="${compile.optimize}" destdir="${build.class.dir}">
      <compilerarg compiler="modern" value="-Xlint:all"/>
      <src path="${src.dir}/main/java"/>
    </javac>
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <jni-classes basedir="${build.class.dir}" property="jni.classes">
      <src path="${src.dir}/main/java"/>
    </jni-classes>
  </target>

  <target name="jar"
          description="--> Construct iprotium-util.jar."
          depends="buildnumber,classes">
    <jar destfile="${build.dir}/${artifact}">
      <fileset dir="${build.class.dir}"/>
      <manifest>
        <attribute name="Built-By" value="${user.name}"/>
        <section name="iprotium/io/">
          <attribute name="Extension-Name" value="iprotium.io"/>
          <attribute name="Specification-Title" value="${pom.artifactId}"/>
          <attribute name="Specification-Version" value="${pom.version}"/>
          <attribute name="Specification-Vendor" value="${vendor}"/>
          <attribute name="Implementation-Title" value="iprotium.io"/>
          <attribute name="Implementation-Version"
                     value="${pom.version}.${buildnumber.date}"/>
          <attribute name="Implementation-Vendor" value="${vendor}"/>
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/util/">
          <attribute name="Extension-Name" value="iprotium.util"/>
          <attribute name="Specification-Title" value="${pom.artifactId}"/>
          <attribute name="Specification-Version" value="${pom.version}"/>
          <attribute name="Specification-Vendor" value="${vendor}"/>
          <attribute name="Implementation-Title" value="iprotium.util"/>
          <attribute name="Implementation-Version"
                     value="${pom.version}.${buildnumber.date}"/>
          <attribute name="Implementation-Vendor" value="${vendor}"/>
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/util/ant/taskdefs/">
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/util/ant/types/">
          <attribute name="Sealed" value="true"/>
        </section>
        <section name="iprotium/util/jni/">
          <attribute name="Sealed" value="true"/>
        </section>
      </manifest>
    </jar>
    <jarlib-display file="${build.dir}/${artifact}"/>
  </target>

  <target name="headers"
          description="--> Compile JNI headers."
          depends="classes" if="jni.classes">
    <mkdir dir="${build.header.dir}"/>
    <javah classpathref="build.classpath" class="${jni.classes}"
           destdir="${build.header.dir}"/>
  </target>

  <target name="objects"
          description="--> Compile JNI objects."
          depends="headers" if="jni.classes">
    <mkdir dir="${build.object.dir}"/>
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <jni-cc include="${build.header.dir}" dest="${build.object.dir}">
      <fileset dir="${src.dir}/main/c" includes="*.c"/>
      <mapper type="glob" from="*.c" to="*.o"/>
    </jni-cc>
  </target>

  <target name="library"
          description="--> Compile JNI library."
          depends="objects">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <jni-ld>
      <fileset dir="${build.object.dir}" includes="**/*.o"/>
    </jni-ld>
  </target>

  <target name="install"
          description="--> Installs pom.xml and artifacts to local repository."
          depends="jar">
    <artifact:install file="${build.dir}/${artifact}">
      <pom refid="pom"/>
      <!-- <attach file="${build.dir}/lib${pom.artifactId}.so" type="so"/> -->
    </artifact:install>
  </target>

  <target name="bean-info-for"
          description="--> Invokes &lt;bean-info-for/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <bean-info-for classpathref="build.classpath" type="${type}"/>
  </target>

  <target name="instance-of"
          description="--> Invokes &lt;instance-of/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <instance-of classpathref="build.classpath"
                 type="${type}" argument="${argument}"/>
  </target>

  <target name="is-assignable-from"
          description="--> Invokes &lt;is-assignable-from/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <is-assignable-from classpathref="build.classpath"
                        type="${type}" subtype="${subtype}"/>
  </target>

  <target name="jni-classes"
          description="--> Invokes &lt;jni-classes/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <jni-classes basedir="${build.class.dir}">
      <src path="${src.dir}/main/java"/>
    </jni-classes>
  </target>

  <target name="list-resources"
          description="--> Invokes &lt;list-resources/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <list-resources name="${name}"/>
  </target>

  <target name="members-of"
          description="--> Invokes &lt;members-of/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <members-of classpathref="build.classpath" type="${type}"/>
  </target>

  <target name="serialVersionUID"
          description="--> Invokes &lt;serialVersionUID/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <serialVersionUID basedir="${build.class.dir}">
      <src path="${src.dir}/main/java"/>
    </serialVersionUID>
  </target>

  <target name="show-properties"
          description="--> Invokes &lt;show-properties/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <show-properties basedir="${build.class.dir}">
      <src path="${src.dir}/main/java"/>
    </show-properties>
  </target>

  <target name="superclasses-of"
          description="--> Invokes &lt;superclasses-of/&gt; task."
          depends="classes">
    <taskdef classpathref="build.classpath"
             resource="iprotium/util/ant/defaults.properties"/>
    <superclasses-of classpathref="build.classpath" type="${type}"/>
  </target>

</project>
<!--
    $Log: not supported by cvs2svn $
    Revision 1.11  2008/11/26 08:22:02  ball
    Added <instance-of/> build target and Ant Task.

    Revision 1.10  2008/11/20 06:36:30  ball
    Added <bean-info-for/> build target and Ant Task.

    Revision 1.9  2008/11/18 07:36:44  ball
    Interim check-in.

  -->
